= Getting Ready for the labs
:experimental:
:imagesdir: images

In this lab, you will go deeper into how to use the OpenShift Container Platform as a developer to build and deploy applications. We’ll focus on the core features of OpenShift as it relates to developers, and you’ll learn typical workflows for a developer (develop, build, test, deploy, and repeat).

=== Getting Ready for the labs

You will be using Red Hat CodeReady Workspaces, an online IDE based on https://www.eclipse.org/che/[Eclipse Che^]. *Changes to files are auto-saved every few seconds*, so you don’t need to explicitly save changes.

To get started, {{ ECLIPSE_CHE_URL }}[access the CodeReady Workspaces instance^] and log in using the username and password you’ve been assigned (e.g. `{{ USER_ID }}/{{ CHE_USER_PASSWORD }}`):

image::che-login.png[cdw, 700]

Once you log in, you’ll be placed on your personal dashboard. Click on the name of
the pre-created workspace on the left, as shown below (the name will be different depending on your assigned number).

image::crw-landing.png[cdw, 700]

You can also click on the name of the workspace in the center, and then click on the green {{ USER_ID}}-namespace that says _Open_ on the top right hand side of the screen:

image::crw-landing-start.png[cdw, 700]

After a minute or two, you’ll be placed in the workspace:

image::che-workspace.png[cdw, 900]

This IDE is based on Eclipse Che (which is in turn based on MicroSoft VS Code editor).

You can see icons on the left for navigating between project explorer, search, version control (e.g. Git), debugging, and other plugins.  You’ll use these during the course of this workshop. Feel free to click on them and see what they do:

image::crw-icons.png[cdw, 400]

[NOTE]
====
If things get weird or your browser appears, you can simply reload the browser tab to refresh the view.
====

Many features of CodeReady Workspaces are accessed via *Commands*. You can see a few of the commands listed with links on the home page (e.g. _New File.._, _Git Clone.._, and others).

If you ever need to run commands that you don't see in a menu, you can press kbd:[F1] to open the command window, or the more traditional kbd:[Control+SHIFT+P] (or kbd:[Command+SHIFT+P] on Mac OS X).

==== Import Projects

Let's import the project source code for this lab. Click on **Git Clone..** (or type kbd:[F1], enter 'git' and click on the auto-completed _Git Clone.._ )

image::che-workspace-gitclone.png[cdw, 900]

Step through the prompts, using the following value for **Repository URL**. If you use *FireFox*, it may end up pasting extra spaces at the end, so just press backspace after pasting:

[source,none,role="copypaste"]
----
https://github.com/pkstaz/cloud-native-workshop-v2m2-labs.git
----

image::crw-clone-repo.png[crw,900]

Ensure `projects/` is selected, then click on *Select Repository Location* then click on *Open*:

image::crw-add-workspace-2.png[crw, 900]

Note that you probably need to reload your web browser to load the new workspace.

The project is imported into your workspace and is visible in the project explorer (collapse the *OPEN EDITORS*):

image::crw-clone-explorer.png[crw,900]

==== IMPORTANT: Check out proper Git branch

To make sure you're using the right version of the project files, run this command in a CodeReady Terminal:

[source,sh,role="copypaste"]
----
cd $CHE_PROJECTS_ROOT/cloud-native-workshop-v2m2-labs && git checkout ocp-4.10
----

[NOTE]
====
The Terminal window in CodeReady Workspaces. You can open a terminal window for any of the containers running in your Developer workspace. For the rest of these labs, anytime you need to run a command in a terminal, you can use the **>_ New Terminal** command on the right:

image::codeready-workspace-terminal.png[codeready-workspace-terminal, 700]
====

=== Remove other projects

If you've completed other modules today (such as `cloud-native-workshop-v2m1-labs`), remove them from your workspace by right-clicking on the project name in the explorer and choose *Delete* and accept the warning. Be sure not to delete the new project you just imported for this lab!

[source,sh,role="copypaste"]
----
rm -rf $CHE_PROJECTS_ROOT/cloud-native-workshop-v2m1-labs
----

=== Login to OpenShift

Although your Eclipse Che workspace is running on the Kubernetes cluster, it’s running with a default restricted _Service Account_ that prevents you from creating most resource types. If you’ve completed other modules, you’re probably already logged in, but let’s login again: click on *Login to OpenShift*:

[NOTE]
====
When you click on this, CodeReady Workspaces executes the following command:
*oc login https://$KUBERNETES_SERVICE_HOST:$KUBERNETES_SERVICE_PORT --insecure-skip-tls-verify=true --username={{ USER_ID }} --password={{ OPENSHIFT_USER_PASSWORD }}*
====

image::cmd-login.png[login,700]

You should see something like this (the project names may be different):

[source,none]
----
Login successful.

You have access to the following projects and can switch between them with 'oc project <projectname>':

  * {{ USER_ID }}-bookinfo
    {{ USER_ID }}-catalog
    {{ USER_ID }}-cloudnative-pipeline
    {{ USER_ID }}-cloudnativeapps
    {{ USER_ID }}-inventory
    {{ USER_ID }}-istio-system

Using project "{{ USER_ID }}-bookinfo".
Welcome! See 'oc help' to get started.
----

[NOTE]
====
After you log in using *Login to OpenShift*, the terminal is no longer usable as a regular terminal. You can close the terminal window. You will still be logged in when you open more terminals later!
====

==== Do this if this is the first module you're doing today, otherwise continue to the Verifying the Dev Environment!

These commands reset and re-play all the steps from module 1 and should take 4-5 minutes to finish.

[WARNING]
====
*You do not need to run these if you already completed the Optimizing Existing Applications lab and have created `catalog` and `inventory` and the CoolStore `monolith` projects!*
====

[source, sh, role="copypaste"]
----
sh /projects/cloud-native-workshop-v2m2-labs/monolith/scripts/deploy-inventory.sh {{ USER_ID }} && \
sh /projects/cloud-native-workshop-v2m2-labs/monolith/scripts/deploy-catalog.sh {{ USER_ID }} && \
sh /projects/cloud-native-workshop-v2m2-labs/monolith/scripts/deploy-coolstore.sh {{ USER_ID }}
----

[WARNING]
====
It sometimes takes time to create a new build image for network latency in OpenShift. So if you got failed to deploy catalog-service with *Error from server (NotFound): services "catalog-springboot" not found*. Please try again with delay via the following command:
====

[source, sh, role="copypaste"]
----
sh /projects/cloud-native-workshop-v2m2-labs/monolith/scripts/deploy-inventory.sh {{ USER_ID }} && \
sh /projects/cloud-native-workshop-v2m2-labs/monolith/scripts/deploy-catalog.sh {{ USER_ID }} 3m && \
sh /projects/cloud-native-workshop-v2m2-labs/monolith/scripts/deploy-coolstore.sh {{ USER_ID }}
----

Wait for the commands to complete.

=== Verifying the Dev Environment

In the previous module, you created a new OpenShift project called *{{ USER_ID }}-coolstore-dev* which represents your developer personal
project in which you deployed the CoolStore monolith.

==== Verify Application

Let’s take a moment and review the OpenShift resources that are created for the Inventory Service:

[NOTE]
====
When referring to Kubernetes or OpenShift object types in `oc` commands, you can use short synonyms for long words, like *bc* instead of *buildconfig*, *is* for *imagestream*, *dc* for *deploymentconfig*, *svc* for *service*, etc.

Don’t worry about reading and understanding the output of oc describe. Just make sure the command doesn’t report errors!
====

Run these commands to inspect the elements via CodeReady Workspaces Terminal window:

[source,sh,role="copypaste"]
----
oc project {{ USER_ID }}-inventory && \
oc get bc inventory && \
oc get is inventory && \
oc get dc inventory && \
oc get svc inventory 
----

You should get a valid value for each, and no errors!

Visit the {{ CONSOLE_URL }}/topology/ns/{{ USER_ID }}-inventory[Topology View^] to see the inventory app (and its database). The *Topology* view in the _Developer_ perspective of the OpenShift web console provides a visual representation of all the applications within a project, their build status, and the components and services associated with them. You'll visit this often:

image::inventory-dev-topology.png[crw,700]
